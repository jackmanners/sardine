% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/withings-sleep.R
\name{withings_sleep}
\alias{withings_sleep}
\title{Create a Withings Sleep Analysis Object}
\usage{
withings_sleep(
  summary = NULL,
  epoch,
  id_cols = c("w_id", "sleep_id", "id"),
  tz_cols = c("w_timezone", "timezone")
)
}
\arguments{
\item{summary}{Optional. A data frame or tibble containing sleep summary data
with one row per sleep session. If NULL, only epoch-based analyses (like SRI)
will be available. Expected columns include:
\itemize{
\item \strong{ID column}: One of \code{w_id}, \code{sleep_id}, or \code{id} to match with epoch data
\item \strong{Timezone}: One of \code{w_timezone} or \code{timezone} (e.g., "America/New_York", "UTC")
\item \strong{Sleep metrics} (optional): \code{w_total_sleep_time}, \code{w_sleep_efficiency},
\code{w_sleep_latency}, \code{w_waso}, \code{w_apnea_hypopnea_index}, \code{w_snoring}
\item \strong{Timestamps}: \code{w_startdate_utc}, \code{w_enddate_utc} as POSIXct
}}

\item{epoch}{A data frame or tibble containing minute-by-minute sleep epoch data.
Required columns:
\itemize{
\item \strong{timestamp}: Unix timestamp (seconds since 1970-01-01 00:00:00 UTC)
\item \strong{state}: Sleep state code (0 = awake, 1 = light sleep, 2 = deep sleep, 3 = REM)
\item \strong{ID column}: One of \code{w_id}, \code{sleep_id}, or \code{id} to match with summary
}
Optional columns for enhanced analysis:
\itemize{
\item \code{hr}: Heart rate (beats per minute)
\item \code{rr}: Respiratory rate (breaths per minute)
\item \code{snoring}: Snoring intensity
\item \code{mvt_score}: Movement score (used as acceleration proxy for GGIR)
}}

\item{id_cols}{Character vector of candidate ID column names to try for matching
summary and epoch data. Default: \code{c("w_id", "sleep_id", "id")}}

\item{tz_cols}{Character vector of candidate timezone column names in summary data.
Default: \code{c("w_timezone", "timezone")}}
}
\value{
An S3 object of class \code{withings_sleep} with components:
\describe{
\item{summary}{Processed summary data (NULL if not provided)}
\item{epoch}{Processed epoch data with added datetime columns}
\item{$report()}{Method to generate HTML/PDF report (requires summary data)}
\item{$reformat()}{Method to export data in various formats (e.g., GGIR)}
\item{$sri()}{Method to calculate Sleep Regularity Index from epoch data}
}
}
\description{
Constructs a \code{withings_sleep} object from Withings sleep data for analysis,
reporting, and export. Can work with epoch data alone (for SRI calculation)
or with both summary and epoch data (for full reporting).
}
\details{
The function is flexible and can handle different input scenarios:

\strong{Epoch-only mode} (summary = NULL):
\itemize{
\item Only \verb{$sri()} and \verb{$reformat()} methods will work
\item Useful when you only have raw epoch data and want to calculate sleep regularity
\item \verb{$report()} will fail with an informative error
}

\strong{Full mode} (both summary and epoch):
\itemize{
\item All methods available including interactive HTML reports
\item Data are automatically combined and aligned by ID
\item Datetime columns added to epoch data for plotting
}
}
\examples{
\dontrun{
# Load data from CSV files
summary <- read.csv("withings_summary.csv")
epoch <- read.csv("withings_epoch.csv")

# Full analysis with both summary and epoch
wsleep <- withings_sleep(summary, epoch)
wsleep$report(output = "html", file = "sleep_report.html")
wsleep$sri()

# Epoch-only analysis (e.g., for SRI calculation)
wsleep_minimal <- withings_sleep(summary = NULL, epoch = epoch)
sri_result <- wsleep_minimal$sri()
cat(sri_result$report)

# Export to GGIR format for external analysis
ggir_data <- wsleep$reformat(type = "ggir")
write.csv(ggir_data, "sleep_for_ggir.csv", row.names = FALSE)
}

}
\seealso{
\code{\link{withings_sleep_report}} for summary statistics,
\code{\link{reformat.withings_sleep}} for data export,
\code{\link{withings_sleep_report_render}} for HTML/PDF report generation
}
