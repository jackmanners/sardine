% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/withings-sleep.R
\name{wsleep_sri}
\alias{wsleep_sri}
\title{Calculate Sleep Regularity Index (SRI) from Withings Epoch Data}
\usage{
wsleep_sri(
  x,
  tz = NULL,
  plot_path = NULL,
  assumption = "wake",
  continuity_limit = NULL
)
}
\arguments{
\item{x}{A \code{withings_sleep} object with epoch data}

\item{tz}{Character string specifying timezone for plotting (e.g., "America/New_York").
If NULL, attempts to extract from summary data. Defaults to "UTC" if not found.}

\item{plot_path}{Optional file path to save the raster plot (e.g., "sri_plot.png").
If NULL, plot is generated but not saved.}

\item{assumption}{Character string specifying how to handle missing epoch data:
\describe{
\item{"wake"}{(default) Treat all missing epochs as wake (state = 0)}
\item{"continuity"}{Carry forward the last known sleep/wake state for missing epochs}
}}

\item{continuity_limit}{Optional integer. When \code{assumption = "continuity"}, this limits
how many consecutive minutes to carry forward a state before reverting to wake.
For example, \code{continuity_limit = 10} means gaps longer than 10 minutes revert to wake.
Only applies when \code{assumption = "continuity"}. Default: NULL (no limit).}
}
\value{
A list with three components:
\describe{
\item{sri}{Numeric value between -100 and 100. Higher values indicate more regular
sleep-wake patterns. Values above 80 are considered good regularity.}
\item{raster}{A ggplot2 object showing sleep/wake patterns across days. Black = sleep,
light red = missing/wake. Days are defined as noon-to-noon periods.}
\item{report}{Character string with formatted summary including SRI value, data coverage,
assumption details, and processing statistics.}
}
}
\description{
Computes the Sleep Regularity Index (SRI) from minute-by-minute sleep epoch data
and generates a raster plot visualization of sleep/wake patterns across days.
This is an internal function called by the \verb{$sri()} method of \code{withings_sleep} objects.
}
\details{
\strong{Sleep Regularity Index (SRI):}

SRI quantifies the day-to-day consistency of sleep-wake patterns by comparing binary
sleep/wake states at each minute across consecutive 24-hour periods. The formula is:

\deqn{SRI = -100 + 200 \times (1 - \text{mean}(|S_{t+24h} - S_t|))}

where \eqn{S_t} is the sleep state (0 or 1) at time t.

\strong{Interpretation:}
\itemize{
\item SRI = 100: Perfect regularity (same sleep/wake pattern every day)
\item SRI = 0: Random sleep/wake patterns
\item SRI = -100: Completely reversed patterns (sleep when usually awake, vice versa)
\item SRI > 80: Generally considered good sleep regularity
\item SRI < 60: May indicate irregular sleep schedules
}

\strong{Missing Data Handling:}

Real-world epoch data often has gaps. This function provides two strategies:
\enumerate{
\item \strong{"wake" assumption (default)}: Conservative approach treating all missing data as wake.
Best when gaps represent true wake periods (e.g., device removed during day).
\item \strong{"continuity" assumption}: Assumes sleep/wake state continues during short gaps.
Useful for handling brief data dropouts during sleep sessions.
\itemize{
\item Respects sleep session boundaries (never carries state across different nights)
\item Optional \code{continuity_limit} prevents infinite carry-forward into long gaps
}
}

\strong{Requirements:}
\itemize{
\item Minimum 2 days of data (2 × 24 × 60 = 2,880 minutes)
\item Epoch data must include \code{timestamp} and \code{state} columns
\item Sleep states are binarized: 0 = wake, 1+ (light/deep/REM) = sleep
}
}
\examples{
\dontrun{
# Create withings_sleep object (epoch-only mode)
wsleep <- withings_sleep(summary = NULL, epoch = epoch_data)

# Calculate SRI with default settings
result <- wsleep$sri()
cat(result$report)
print(result$sri)
print(result$raster)

# Save plot to file
result <- wsleep$sri(plot_path = "sri_plot.png")

# Use continuity assumption for missing data
result <- wsleep$sri(
  assumption = "continuity",
  continuity_limit = 10  # Max 10 minutes carry-forward
)

# Specify timezone explicitly
result <- wsleep$sri(tz = "America/Los_Angeles", plot_path = "sri_LA.png")
}

}
\references{
Phillips AJK, et al. (2017). Irregular sleep/wake patterns are associated with
poorer academic performance and delayed circadian and sleep/wake timing.
Scientific Reports, 7, 3216.
}
\seealso{
\code{\link{withings_sleep}} for creating sleep objects
}
\keyword{internal}
